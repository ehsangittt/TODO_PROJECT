{% extends 'todos/main.html' %}

{% block content %}

<!-- Header -->
<div class="row mb-4 align-items-center">
    <div class="col">
        <h2>My Tasks</h2>
        <p class="text-muted">
            Number of incomplete tasks: {{ count }}
        </p>
    </div>
    <div class="col text-end">
        <span class="me-3">
            Hello {{ request.user.username }} ðŸ‘‹
        </span>
        <!-- Logout Form -->
        <form method="post" action="{% url 'logout' %}" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger btn-sm">
                Logout
            </button>
        </form>
    </div>
</div>

<!-- Create Task -->
<div class="mb-4 text-end">
    <a href="{% url 'task-create' %}" class="btn btn-primary">
        + Add New Task
    </a>
</div>

<!-- Search & Sort -->
<form method="get" class="mb-4">
    <div class="row g-2">
        <div class="col-md-6">
            <input
                type="text"
                name="search-area"
                class="form-control"
                placeholder="Search by title..."
                value="{{ search_input }}"
            >
        </div>

        <div class="col-md-4">
            <select name="sort" class="form-select">
                <option value="-created_at" {% if sort_by == "-created_at" %}selected{% endif %}>
                    Newest
                </option>
                <option value="due_date" {% if sort_by == "due_date" %}selected{% endif %}>
                    Due Date (Ascending)
                </option>
                <option value="-due_date" {% if sort_by == "-due_date" %}selected{% endif %}>
                    Due Date (Descending)
                </option>
                <option value="priority" {% if sort_by == "priority" %}selected{% endif %}>
                    Priority
                </option>
            </select>
        </div>

        <div class="col-md-2 d-grid">
            <button type="submit" class="btn btn-secondary">
                Apply
            </button>
        </div>
    </div>
</form>

<!-- Task List -->
{% if tasks %}
<table class="table table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>Title</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Due Date</th>
            <th class="text-end">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for task in tasks %}
        <tr>
            <td>{{ task.title }}</td>
            <td>
                {% if task.status == "DONE" %}
                    <span class="badge bg-success">Completed</span>
                {% else %}
                    <span class="badge bg-warning text-dark">Pending</span>
                {% endif %}
            </td>
            <td>{{ task.priority }}</td>
            <td>{{ task.due_date|default:"â€”" }}</td>
            <td class="text-end">
                <a href="{% url 'task-update' task.id %}" class="btn btn-sm btn-outline-primary">
                    Edit
                </a>
                <a href="{% url 'task-delete' task.id %}" class="btn btn-sm btn-outline-danger">
                    Delete
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="alert alert-info">
    No tasks yet.
</div>
{% endif %}

<!-- Pagination -->
{% if is_paginated %}
<nav class="mt-4">
    <ul class="pagination justify-content-center">

        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link"
               href="?page={{ page_obj.previous_page_number }}&search-area={{ search_input }}&sort={{ sort_by }}">
                Previous
            </a>
        </li>
        {% endif %}

        <li class="page-item disabled">
            <span class="page-link">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>
        </li>

        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link"
               href="?page={{ page_obj.next_page_number }}&search-area={{ search_input }}&sort={{ sort_by }}">
                Next
            </a>
        </li>
        {% endif %}
 
    </ul>
</nav>
{% endif %}

{% endblock %}
